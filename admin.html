<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<script>
if (localStorage.getItem("admin") !== "1") {
  location.href = "admin-login.html";
}
</script>

<div class="container">
  <h2>Admin Panel</h2>

  <button class="btn-danger" onclick="hepsiniSil()">ðŸ—‘ TÃ¼mÃ¼nÃ¼ Sil</button>
  <button class="btn" onclick="cikis()">Ã‡Ä±kÄ±ÅŸ</button>

  <hr>

  <!-- DÃœZENLEME FORMU -->
  <div id="editBox" class="card" style="display:none">
    <h3>Ä°lan DÃ¼zenle</h3>

    <input id="e_marka" placeholder="Marka">
    <input id="e_model" placeholder="Model">
    <input id="e_yil" placeholder="YÄ±l">
    <input id="e_km" placeholder="Kilometre">
    <input id="e_fiyat" placeholder="Fiyat">
    <input id="e_tel" placeholder="Telefon">

    <label>Yeni FotoÄŸraf (isteÄŸe baÄŸlÄ±)</label>
    <input type="file" id="e_foto" accept="image/*">

    <br><br>
    <button class="btn-success" onclick="kaydetDuzenleme()">Kaydet</button>
    <button class="btn-danger" onclick="iptal()">Ä°ptal</button>
  </div>

  <hr>

  <!-- Ä°LAN LÄ°STESÄ° -->
  <div id="liste"></div>
</div>

<script>
let ilanlar = JSON.parse(localStorage.getItem("ilanlar") || "[]");
let duzenlenenIndex = null;
const alan = document.getElementById("liste");

function ciz() {
  alan.innerHTML = "";
  ilanlar.forEach((i, index) => {
    alan.innerHTML += `
      <div class="card">
        <img src="${i.foto}" style="width:100%;height:150px;object-fit:cover">
        <b>${i.marka} ${i.model}</b><br>
        YÄ±l:${i.yil} KM:${i.km}<br>
        Fiyat:${i.fiyat} â‚º<br>
        Tel:${i.tel}<br>
        Durum:${i.durum}<br><br>

        <button class="btn" onclick="duzenle(${index})">DÃ¼zenle</button>
        <button class="btn-success" onclick="onayla(${index})">Onayla</button>
        <button class="btn-danger" onclick="sil(${index})">Sil</button>
      </div>
    `;
  });
}

function duzenle(index) {
  duzenlenenIndex = index;
  const i = ilanlar[index];

  e_marka.value = i.marka;
  e_model.value = i.model;
  e_yil.value = i.yil;
  e_km.value = i.km;
  e_fiyat.value = i.fiyat;
  e_tel.value = i.tel;

  document.getElementById("editBox").style.display = "block";
  window.scrollTo(0, 0);
}

function kaydetDuzenleme() {
  if (duzenlenenIndex === null) return;

  const i = ilanlar[duzenlenenIndex];

  i.marka = e_marka.value;
  i.model = e_model.value;
  i.yil = e_yil.value;
  i.km = e_km.value;
  i.fiyat = e_fiyat.value;
  i.tel = e_tel.value;

  const file = document.getElementById("e_foto").files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      i.foto = e.target.result;
      kaydet();
    };
    reader.readAsDataURL(file);
  } else {
    kaydet();
  }
}

function iptal() {
  duzenlenenIndex = null;
  document.getElementById("editBox").style.display = "none";
}

function onayla(i) {
  ilanlar[i].durum = "onayli";
  kaydet();
}

function sil(i) {
  ilanlar.splice(i, 1);
  kaydet();
}

function hepsiniSil() {
  if (confirm("TÃ¼m ilanlar silinsin mi?")) {
    ilanlar = [];
    localStorage.removeItem("ilanlar");
    ciz();
  }
}

function kaydet() {
  localStorage.setItem("ilanlar", JSON.stringify(ilanlar));
  document.getElementById("editBox").style.display = "none";
  duzenlenenIndex = null;
  ciz();
}

function cikis() {
  localStorage.removeItem("admin");
  location.href = "admin-login.html";
}

ciz();
</script>

</body>
</html>
