<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>İLKEL OTO ADMIN</title>

<style>

body{
margin:0;
font-family:Arial;
background:#111;
color:white;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
}

.panel{
background:#222;
padding:25px;
border-radius:10px;
width:340px;
}

.panel h2{
text-align:center;
margin-bottom:15px;
}

input{
width:100%;
padding:10px;
margin-bottom:10px;
border-radius:6px;
border:none;
}

button{
width:100%;
padding:12px;
background:#00c853;
border:none;
border-radius:6px;
font-weight:bold;
cursor:pointer;
margin-bottom:8px;
}

.logout{
background:#ff3b3b;
}

.msg{
text-align:center;
margin-top:10px;
color:#00ff90;
}

</style>
</head>

<body>

<div class="panel">

<h2>İlan Ekle</h2>

<input id="brand" placeholder="Marka">
<input id="model" placeholder="Model">
<input id="year" type="number" placeholder="Yıl">
<input id="km" type="number" placeholder="Kilometre">
<input id="price" type="number" placeholder="Fiyat">

<input type="file" id="photo">

<button onclick="saveCar()">Kaydet</button>
<button class="logout" onclick="logout()">Çıkış Yap</button>

<div class="msg" id="msg"></div>

</div>

<script>
// GİRİŞ KONTROL
if(localStorage.getItem("adminLogin")!=="true"){
location.href="admin-login.html";
}

function logout(){
localStorage.removeItem("adminLogin");
location.href="admin-login.html";
}
</script>

<!-- FIREBASE -->

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

const firebaseConfig = {
apiKey: "AIzaSyDp3wjVf9w3MTFt0B1o4Jcdc_H9nvlqSY8",
authDomain: "ilkeloto.firebaseapp.com",
projectId: "ilkeloto",
storageBucket: "ilkeloto.appspot.com",
messagingSenderId: "503658235063",
appId: "1:503658235063:web:e271d2bc989be290b97932"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

window.saveCar = async function(){

const brand = brand.value;
const model = model.value;
const year = year.value;
const km = km.value;
const price = price.value;
const file = photo.files[0];

if(!brand || !model || !year || !km || !price || !file){
alert("Tüm alanları doldur + foto seç");
return;
}

// FOTO YÜKLE
const fileRef = ref(storage, "cars/"+Date.now()+"-"+file.name);
await uploadBytes(fileRef, file);
const imageURL = await getDownloadURL(fileRef);

// FIRESTORE KAYIT
await addDoc(collection(db,"cars"),{
brand,
model,
year:Number(year),
km:Number(km),
price:Number(price),
image:imageURL,
created:new Date()
});

msg.innerText="İlan başarıyla eklendi";

// TEMİZLE
brand.value="";
model.value="";
year.value="";
km.value="";
price.value="";
photo.value="";

}

</script>

</body>
</html>
