<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Admin Panel | Ä°lkel Oto</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#111;color:#fff;margin:0}
.center{max-width:400px;margin:120px auto;background:#1e1e1e;padding:30px;border-radius:8px;text-align:center}
input,button{width:100%;padding:12px;margin-top:10px;font-size:15px}
button{cursor:pointer;border:none}
.login-btn{background:#fff;color:#000}
.err{color:#ff6b6b;margin-top:10px}

.container{max-width:1100px;margin:40px auto;display:none}
.card{background:#1e1e1e;padding:20px;margin-bottom:15px;border-radius:6px}
.row{display:flex;flex-wrap:wrap;gap:10px}
.row div{flex:1;min-width:200px}

.onay{background:green;color:#fff;padding:8px 14px}
.sil{background:red;color:#fff;padding:8px 14px}
.foto{background:#444;color:#fff;padding:8px 14px;margin-left:5px}
.logout{background:#333;color:#fff;padding:8px 14px;float:right}
</style>
</head>

<body>

<!-- GÄ°RÄ°Åž -->
<div class="center" id="login">
  <h2>Admin GiriÅŸ</h2>
  <input type="password" id="sifre" placeholder="Åžifre">
  <button class="login-btn" onclick="giris()">GÄ°RÄ°Åž</button>
  <div id="hata" class="err"></div>
</div>

<!-- PANEL -->
<div class="container" id="panel">
  <button class="logout" onclick="cikis()">Ã‡Ä±kÄ±ÅŸ</button>
  <h1>Bekleyen Ä°lanlar</h1>
  <div id="ilanlar">YÃ¼kleniyor...</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, query, where, getDocs,
  updateDoc, deleteDoc, doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ðŸ”‘ ADMIN ÅžÄ°FRESÄ° */
const ADMIN_SIFRE = "ilkel123";

/* GÄ°RÄ°Åž */
if(localStorage.getItem("admin")==="ok"){ acPanel(); }

window.giris = function(){
  if(sifre.value === ADMIN_SIFRE){
    localStorage.setItem("admin","ok");
    acPanel();
  }else{
    hata.innerText="Åžifre yanlÄ±ÅŸ";
  }
};

window.cikis = function(){
  localStorage.removeItem("admin");
  location.reload();
};

function acPanel(){
  login.style.display="none";
  panel.style.display="block";
  yukle();
}

/* FIREBASE */
const firebaseConfig = {
  apiKey: "API_KEYÄ°N",
  authDomain: "ilkeloto.firebaseapp.com",
  projectId: "ilkeloto"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const alan = document.getElementById("ilanlar");

async function yukle(){
  alan.innerHTML="";
  const q = query(collection(db,"ilanlar"), where("durum","==","beklemede"));
  const snap = await getDocs(q);

  if(snap.empty){
    alan.innerHTML="Bekleyen ilan yok.";
    return;
  }

  snap.forEach(d=>{
    const i = d.data();
    alan.innerHTML += `
      <div class="card">
        <div class="row">
          <div><b>${i.marka} ${i.model}</b></div>
          <div>YÄ±l: ${i.yil}</div>
          <div>KM: ${i.km}</div>
          <div>Fiyat: ${i.fiyat} â‚º</div>
        </div>

        <p>${i.aciklama || ""}</p>
        <p><b>Tel:</b> ${i.telefon}</p>

        <button class="onay" onclick="onayla('${d.id}')">ONAYLA</button>
        <button class="sil" onclick="sil('${d.id}')">SÄ°L</button>
        <button class="foto" onclick="fotoEkle('${d.id}')">FOTO EKLE</button>
      </div>
    `;
  });
}

window.onayla = async id=>{
  await updateDoc(doc(db,"ilanlar",id), {durum:"onayli"});
  yukle();
};

window.sil = async id=>{
  if(!confirm("Silinsin mi?")) return;
  await deleteDoc(doc(db,"ilanlar",id));
  yukle();
};

window.fotoEkle = id=>{
  window.open("foto-ekle.html?id="+id,"_blank");
};
</script>

</body>
</html>
