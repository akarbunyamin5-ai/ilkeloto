<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<style>
body{
  font-family:Arial;
  background:#f2f2f2;
  padding:30px;
}
header{
  background:#000;
  color:#fff;
  padding:15px;
  margin-bottom:20px;
}
.ilan{
  background:#fff;
  padding:15px;
  margin-bottom:15px;
  border-radius:6px;
}
button{
  padding:6px 12px;
  margin-right:10px;
}
</style>
</head>
<body>

<header>
  <h2>Admin Panel</h2>
  <button onclick="cikis()">Ã‡Ä±kÄ±ÅŸ</button>
</header>

<div id="ilanlar">YÃ¼kleniyor...</div>

<script>
/* ğŸ” Basit admin koruma */
if(localStorage.getItem("admin") !== "true"){
  window.location.href = "admin-login.html";
}
function cikis(){
  localStorage.removeItem("admin");
  window.location.href = "admin-login.html";
}
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  doc,
  updateDoc,
  deleteDoc,
  query,
  where
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ğŸ”¥ Firebase ayarlarÄ± */
const firebaseConfig = {
  apiKey: "AIzaSyDp3wjVF9w3MTFt0B1o4Jcdc_H9nvlqSY8",
  authDomain: "ilkeloto.firebaseapp.com",
  projectId: "ilkeloto"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const alan = document.getElementById("ilanlar");
alan.innerHTML = "";

/* ğŸ”´ SADECE beklemede olan ilanlarÄ± Ã§ek */
const q = query(
  collection(db,"ilanlar"),
  where("durum","==","beklemede")
);

const snap = await getDocs(q);

if(snap.empty){
  alan.innerHTML = "Beklemede ilan yok.";
}

snap.forEach(docSnap=>{
  const d = docSnap.data();
  const id = docSnap.id;

  const div = document.createElement("div");
  div.className = "ilan";

  div.innerHTML = `
    <b>${d.marka} ${d.model}</b><br>
    YÄ±l: ${d.yil}<br>
    KM: ${d.km ?? "-"}<br>
    Fiyat: ${d.fiyat} â‚º<br>
    Ekspertiz: ${d.ekspertiz}<br>
    <p>${d.aciklama}</p>

    <button onclick="onay('${id}')">Onayla</button>
    <button onclick="sil('${id}')">Sil</button>
  `;

  alan.appendChild(div);
});

/* âœ… ONAYLA */
window.onay = async function(id){
  await updateDoc(doc(db,"ilanlar",id),{
    durum: "onayli"
  });
  location.reload();
};

/* âŒ SÄ°L */
window.sil = async function(id){
  if(confirm("Ä°lan silinsin mi?")){
    await deleteDoc(doc(db,"ilanlar",id));
    location.reload();
  }
};
</script>

</body>
</html>
