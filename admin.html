<script>
if(localStorage.getItem("admin") !== "true"){
  window.location.href = "admin-login.html";
}
</script>
<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Ä°lkel Oto â€“ Admin Panel</title>

<style>
body {
  font-family: Arial;
  background:#f5f5f5;
  margin:0;
}
header {
  background:#000;
  color:#fff;
  padding:20px;
  text-align:center;
}
.container {
  max-width:900px;
  margin:20px auto;
}
.card {
  background:#fff;
  padding:15px;
  margin-bottom:15px;
  border-radius:6px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
button {
  padding:8px 12px;
  border:none;
  border-radius:4px;
  cursor:pointer;
  margin-right:8px;
}
.onay {
  background:green;
  color:white;
}
.sil {
  background:crimson;
  color:white;
}
.cikis {
  background:#444;
  color:white;
  margin:10px;
}
</style>
</head>

<body>

<header>
  <h1>ADMIN PANEL</h1>
  <p>Sadece Beklemede Olan Ä°lanlar</p>
  <button class="cikis" onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
</header>

<div class="container" id="ilanlar">
  YÃ¼kleniyor...
</div>

<script type="module">
/* ðŸ”¥ FIREBASE IMPORT */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getAuth, 
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
  getFirestore,
  collection,
  getDocs,
  doc,
  updateDoc,
  deleteDoc,
  query,
  where
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ðŸ”‘ FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyDp3wjVF9w3MTFt0B1o4Jcdc_H9nvlqSY8",
  authDomain: "ilkeloto.firebaseapp.com",
  projectId: "ilkeloto"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ðŸ” GÄ°RÄ°Åž KONTROL */
onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "admin-login.html";
  }
});

/* ðŸ”´ Ã‡IKIÅž */
window.logout = async function () {
  await signOut(auth);
  window.location.href = "admin-login.html";
};

/* ðŸ“¥ SADECE BEKLEMEDE OLAN Ä°LANLARI Ã‡EK */
const ilanlarDiv = document.getElementById("ilanlar");

async function ilanlariGetir() {
  ilanlarDiv.innerHTML = "";

  const q = query(
    collection(db, "ilanlar"),
    where("Durum", "==", "beklemede")
  );

  const snapshot = await getDocs(q);

  if (snapshot.empty) {
    ilanlarDiv.innerHTML = "Beklemede ilan yok.";
    return;
  }

  snapshot.forEach(docSnap => {
    const d = docSnap.data();
    const id = docSnap.id;

    const div = document.createElement("div");
    div.className = "card";

    div.innerHTML = `
      <h3>${d.Marka} ${d.Model}</h3>
      <p>YÄ±l: ${d.Yil}</p>
      <p>KM: ${d.Km}</p>
      <p>Fiyat: ${d.Fiyat} â‚º</p>

      <button class="onay">Onayla</button>
      <button class="sil">Sil</button>
    `;

    /* âœ… ONAYLA */
    div.querySelector(".onay").onclick = async () => {
      await updateDoc(doc(db, "ilanlar", id), {
        Durum: "onaylÄ±"
      });
      ilanlariGetir();
    };

    /* âŒ SÄ°L */
    div.querySelector(".sil").onclick = async () => {
      if (confirm("Ä°lan silinsin mi?")) {
        await deleteDoc(doc(db, "ilanlar", id));
        ilanlariGetir();
      }
    };

    ilanlarDiv.appendChild(div);
  });
}

ilanlariGetir();
</script>

</body>
</html>
