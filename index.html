<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>İLKEL OTO</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>

body{
margin:0;
font-family:Arial;
background:#f2f2f2;
}

header{
background:#000;
color:white;
padding:15px;
font-size:22px;
font-weight:bold;
}

.container{
display:flex;
padding:15px;
gap:15px;
}

/* SOL PANEL */

.sidebar{
width:260px;
background:white;
padding:15px;
border-radius:8px;
}

.sidebar h3{
margin-top:0;
}

.sidebar input,
.sidebar select{
width:100%;
padding:8px;
margin-bottom:10px;
}

/* İLAN ALANI */

.content{
flex:1;
}

.searchbox{
width:100%;
padding:12px;
font-size:16px;
margin-bottom:15px;
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
gap:15px;
}

.card{
background:white;
padding:12px;
border-radius:8px;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

.card h3{
margin:0;
}

.price{
color:green;
font-weight:bold;
font-size:18px;
margin-top:5px;
}

</style>
</head>

<body>

<header>
İLKEL OTO — Sahibinden Araç Pazarı
</header>

<div class="container">

<div class="sidebar">

<h3>Filtrele</h3>

<select id="brandFilter">
<option value="">Marka</option>
</select>

<input type="number" id="minYear" placeholder="Min Yıl">
<input type="number" id="maxYear" placeholder="Max Yıl">

<input type="number" id="minKm" placeholder="Min KM">
<input type="number" id="maxKm" placeholder="Max KM">

<input type="number" id="minPrice" placeholder="Min Fiyat">
<input type="number" id="maxPrice" placeholder="Max Fiyat">

<button onclick="applyFilter()">Filtrele</button>

</div>

<div class="content">

<input class="searchbox" id="search" placeholder="Ara: Marka, Model">

<div class="grid" id="listings"></div>

</div>

</div>

<!-- FIREBASE -->

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyDp3wjVf9w3MTFt0B1o4Jcdc_H9nvlqSY8",
authDomain: "ilkeloto.firebaseapp.com",
projectId: "ilkeloto",
storageBucket: "ilkeloto.appspot.com",
messagingSenderId: "503658235063",
appId: "1:503658235063:web:e271d2bc989be290b97932"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let allCars = [];

async function loadCars(){

const snapshot = await getDocs(collection(db,"cars"));

allCars = [];

snapshot.forEach(doc=>{
allCars.push(doc.data());
});

renderCars(allCars);
loadBrands();

}

// MARKALARI DOLDUR

function loadBrands(){

const brands = [...new Set(allCars.map(c=>c.brand))];

const select = document.getElementById("brandFilter");
select.innerHTML = `<option value="">Marka</option>`;

brands.forEach(b=>{
select.innerHTML += `<option value="${b}">${b}</option>`;
});

}

// KART ÇİZ

function renderCars(data){

const box = document.getElementById("listings");
box.innerHTML="";

data.forEach(car=>{

box.innerHTML += `
<div class="card">
<h3>${car.brand} ${car.model}</h3>
<p>Yıl: ${car.year}</p>
<p>KM: ${car.km}</p>
<div class="price">${car.price} ₺</div>
</div>
`;

});

}

// FİLTRE

window.applyFilter = function(){

let brand = document.getElementById("brandFilter").value;

let minYear = document.getElementById("minYear").value;
let maxYear = document.getElementById("maxYear").value;

let minKm = document.getElementById("minKm").value;
let maxKm = document.getElementById("maxKm").value;

let minPrice = document.getElementById("minPrice").value;
let maxPrice = document.getElementById("maxPrice").value;

let search = document.getElementById("search").value.toLowerCase();

let filtered = allCars.filter(car=>{

let ok = true;

if(brand && car.brand != brand) ok=false;

if(minYear && car.year < minYear) ok=false;
if(maxYear && car.year > maxYear) ok=false;

if(minKm && car.km < minKm) ok=false;
if(maxKm && car.km > maxKm) ok=false;

if(minPrice && car.price < minPrice) ok=false;
if(maxPrice && car.price > maxPrice) ok=false;

let text = (car.brand + car.model).toLowerCase();
if(search && !text.includes(search)) ok=false;

return ok;

});

renderCars(filtered);

}

// CANLI ARAMA

document.getElementById("search").addEventListener("input",applyFilter);

// YÜKLE

loadCars();

</script>

</body>
</html>
