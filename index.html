<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>İlkel Oto | Onaylı İlanlar</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#f4f4f4}
header{background:#111;color:#fff;padding:20px}
header h1{margin:0;font-size:26px}
header p{margin:5px 0 0;color:#ccc;font-size:14px}

.main{max-width:1300px;margin:20px auto;display:flex;gap:20px;padding:0 15px}

aside{width:260px;background:#fff;border-radius:6px;padding:15px}
aside h3{margin:0 0 10px;font-size:16px}
.list{list-style:none;padding:0;margin:0}
.list li{padding:7px 10px;cursor:pointer;border-radius:4px;font-size:14px}
.list li:hover{background:#eee}
.list li.active{background:#111;color:#fff}

.models{margin-top:10px;padding-left:10px;border-left:2px solid #eee}
.models li{font-size:13px}

.content{flex:1}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px}

.card{background:#fff;border-radius:6px;padding:15px;box-shadow:0 2px 6px rgba(0,0,0,.12);cursor:pointer}
.card:hover{transform:translateY(-2px)}
.price{color:#1a7f37;font-weight:bold;font-size:18px;margin-top:8px}

footer{background:#111;color:#ccc;text-align:center;padding:15px;margin-top:40px;font-size:13px}
</style>
</head>

<body>

<header>
  <h1>İLKEL OTO</h1>
  <p>Onaylı Sahibinden İlanlar</p>
</header>

<div class="main">

<!-- SOL FİLTRE -->
<aside>
  <h3>Markalar</h3>
  <ul id="markalar" class="list">
    <li class="active" data-marka="">Tümü</li>
  </ul>

  <ul id="modeller" class="list models"></ul>
</aside>

<!-- İLANLAR -->
<div class="content">
  <div id="ilanlar" class="grid">Yükleniyor...</div>
</div>

</div>

<footer>© 2026 İlkel Oto</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "API_KEYİN",
  authDomain: "ilkeloto.firebaseapp.com",
  projectId: "ilkeloto"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const ilanAlan = document.getElementById("ilanlar");
const markaAlan = document.getElementById("markalar");
const modelAlan = document.getElementById("modeller");

let tumIlanlar = [];
let aktifMarka = "";
let aktifModel = "";

async function yukle(){
  const q = query(collection(db,"ilanlar"), where("durum","==","onayli"));
  const snap = await getDocs(q);

  tumIlanlar = [];
  const markalar = new Set();

  snap.forEach(d=>{
    const i = { id:d.id, ...d.data() };
    tumIlanlar.push(i);
    markalar.add(i.marka);
  });

  markalar.forEach(m=>{
    const li=document.createElement("li");
    li.textContent=m;
    li.dataset.marka=m;
    markaAlan.appendChild(li);
  });

  filtre();
}

function filtre(){
  let liste = tumIlanlar;

  if(aktifMarka){
    liste = liste.filter(i=>i.marka===aktifMarka);
  }
  if(aktifModel){
    liste = liste.filter(i=>i.model===aktifModel);
  }

  goster(liste);
}

function goster(liste){
  ilanAlan.innerHTML="";
  if(liste.length===0){
    ilanAlan.innerHTML="İlan bulunamadı";
    return;
  }

  liste.forEach(i=>{
    const c=document.createElement("div");
    c.className="card";
    c.onclick=()=>location.href="ilan-detay.html?id="+i.id;
    c.innerHTML=`
      <h3>${i.marka} ${i.model}</h3>
      <p>Yıl: ${i.yil}</p>
      <p>KM: ${i.km}</p>
      <div class="price">${i.fiyat} ₺</div>
      <p><b>Tel:</b> ${i.telefon}</p>
    `;
    ilanAlan.appendChild(c);
  });
}

/* MARKA TIK */
markaAlan.onclick = e=>{
  if(e.target.tagName!=="LI") return;

  document.querySelectorAll("#markalar li").forEach(li=>li.classList.remove("active"));
  e.target.classList.add("active");

  aktifMarka = e.target.dataset.marka;
  aktifModel = "";
  modelAlan.innerHTML="";

  if(!aktifMarka){
    filtre();
    return;
  }

  const modeller = [...new Set(
    tumIlanlar.filter(i=>i.marka===aktifMarka).map(i=>i.model)
  )];

  modeller.forEach(m=>{
    const li=document.createElement("li");
    li.textContent=m;
    li.dataset.model=m;
    modelAlan.appendChild(li);
  });

  filtre();
};

/* MODEL TIK */
modelAlan.onclick = e=>{
  if(e.target.tagName!=="LI") return;

  document.querySelectorAll("#modeller li").forEach(li=>li.classList.remove("active"));
  e.target.classList.add("active");

  aktifModel = e.target.dataset.model;
  filtre();
};

yukle();
</script>

</body>
</html>
