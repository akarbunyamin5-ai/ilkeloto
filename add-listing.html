<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>İlan Ver - İLKEL OTO</title>

<style>
body{background:#111;color:white;font-family:Arial;display:flex;justify-content:center;align-items:center;height:100vh}
.panel{background:#222;padding:25px;border-radius:10px;width:340px}
input,button{width:100%;padding:12px;margin-bottom:10px;border:none;border-radius:6px}
button{background:#00c853;font-weight:bold}
</style>
</head>

<body>

<div class="panel">

<h2>İlan Ver</h2>

<input id="brand" placeholder="Marka">
<input id="model" placeholder="Model">
<input id="year" type="number" placeholder="Yıl">
<input id="km" type="number" placeholder="KM">
<input id="price" type="number" placeholder="Fiyat">

<input type="file" id="photo">

<button onclick="save()">Yayınla</button>

<div id="msg"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

const firebaseConfig = {
apiKey: "AIzaSyDp3wjVf9w3MTFt0B1o4Jcdc_H9nvlqSY8",
authDomain: "ilkeloto.firebaseapp.com",
projectId: "ilkeloto",
storageBucket: "ilkeloto.appspot.com",
messagingSenderId: "503658235063",
appId: "1:503658235063:web:e271d2bc989be290b97932"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

let currentUser;

onAuthStateChanged(auth,user=>{
if(!user){
location.href="login.html";
}else{
currentUser=user;
}
});

window.save=async function(){

const file = photo.files[0];

const refImg = ref(storage,"userCars/"+Date.now()+file.name);
await uploadBytes(refImg,file);
const url = await getDownloadURL(refImg);

await addDoc(collection(db,"cars"),{
brand:brand.value,
model:model.value,
year:Number(year.value),
km:Number(km.value),
price:Number(price.value),
image:url,
owner:currentUser.uid,
created:new Date()
});

msg.innerText="İlan yayınlandı";

}

</script>

</body>
</html>
